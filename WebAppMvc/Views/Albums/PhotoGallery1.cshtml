<h2>Photo Gallery Via DataTable.js</h2>

<!-- Hidden table (backend only for DataTables) -->
<table id="hiddenTable" style="display:none;">
    <thead>
        <tr>
            <th>Id</th>
            <th>ImageUrl</th>
            <th>Title</th>
        </tr>
    </thead>
</table>

<!-- Custom gallery container -->
<div id="photoGallery" class="gallery-grid"></div>

<!-- Lightbox Modal -->
<div id="lightbox" class="lightbox">
    <span class="close">&times;</span>
    <img class="lightbox-img" id="lightboxImage" />
    <div class="caption" id="lightboxCaption"></div>
    <a class="prev">&#10094;</a>
    <a class="next">&#10095;</a>
</div>

<style>
    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }

    .photo-card {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        background: #fff;
        text-align: center;
        transition: transform 0.2s ease-in-out;
        cursor: pointer;
    }

        .photo-card:hover {
            transform: scale(1.05);
        }

        .photo-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

    .photo-title {
        padding: 5px;
       /*  font-weight: bold; */
    }

    /* Lightbox styles */
    .lightbox {
        display: none;
        position: fixed;
        z-index: 9999;
        padding-top: 60px;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: rgba(0,0,0,0.9);
        text-align: center;
    }

    .lightbox-img {
        max-width: 80%;
        max-height: 80%;
        border-radius: 8px;
    }

    .caption {
        color: #ccc;
        padding: 10px;
    }

    .close {
        position: absolute;
        top: 20px;
        right: 40px;
        font-size: 35px;
        font-weight: bold;
        color: #fff;
        cursor: pointer;
    }

    .prev, .next {
        cursor: pointer;
        position: absolute;
        top: 50%;
        padding: 16px;
        color: white;
        font-weight: bold;
        font-size: 30px;
        user-select: none;
        transition: 0.3s;
    }

    .prev {
        left: 20px;
    }

    .next {
        right: 20px;
    }

        .prev:hover, .next:hover {
            color: #f1f1f1;
        }
</style>

@section scripts { 

<script>
        $(document).ready(function () {
               var photosData = [];
               var currentIndex = 0;

               var table = $('#hiddenTable').DataTable({
                   "ajax": {
                       "url": "/Albums/GetPhotos",
                       "type": "GET",
                       "datatype": "json"
                   },
                   "columns": [
                       { "data": "id" },
                       { "data": "imageUrl" },
                       { "data": "title" }
                   ],
                   "pageLength": 10,
                   "drawCallback": function (settings) {
                       var api = this.api();
                       photosData = api.rows({ page: 'current' }).data().toArray();

                       var gallery = $("#photoGallery");
                       gallery.empty();

                       $.each(photosData, function (i, photo) {
                           gallery.append(`
                               <div class="photo-card" data-index="${i}">
                                   <img src="/PhotoGallery/${photo.imageUrl}" alt="${photo.title}" />
                                   <div class="photo-title">${photo.title}</div>
                               </div>
                           `);
                       });
                   }
               });

               // Lightbox functionality
               var lightbox = $("#lightbox");
               var lightboxImg = $("#lightboxImage");
               var lightboxCaption = $("#lightboxCaption");

               // Open lightbox
               $(document).on("click", ".photo-card", function () {
                   currentIndex = parseInt($(this).attr("data-index"));
                   showImage();
                   lightbox.show();
               });

               // Close lightbox
               $(".close").click(function () { lightbox.hide(); });

               // Next / Prev navigation
               $(".next").click(function () {
                   currentIndex = (currentIndex + 1) % photosData.length;
                   showImage();
               });
               $(".prev").click(function () {
                   currentIndex = (currentIndex - 1 + photosData.length) % photosData.length;
                   showImage();
               });

               // Function to show current image
               function showImage() {
                   var photo = photosData[currentIndex];
                   lightboxImg.attr("src", "/PhotoGallery/"+photo.imageUrl);
                   lightboxCaption.text(photo.title);
               }

               // Close on background click
               lightbox.click(function (e) {
                   if (e.target.id === "lightbox") {
                       lightbox.hide();
                   }
               });
           });
</script>
}