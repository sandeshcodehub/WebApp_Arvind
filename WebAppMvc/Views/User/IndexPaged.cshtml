
@{
    ViewData["Title"] = "IndexPaged";
}

<h3>Feedback X.PagedList via Ajax Example</h3>
<button class="btn btn-link" data-id="Add" id="AddNew">Add Feedback</button>
<div id="feedTableContainer">
    @await Html.PartialAsync("_PagedListFeeds", new X.PagedList.StaticPagedList<Feedback>(new List<Feedback>(), 1, 3, 0))
</div>
<!-- Bootstrap Modal Edit-->
<div class="modal fade" id="myModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body" id="myModalContent">
                <!-- Partial view will be loaded here -->
            </div>
        </div>
    </div>
</div>
<input type="hidden" id="hdnPageNo" />
@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        function loadPage(pageNumber) {
            $.get('@Url.Action("FeedbackTablePaged", "User")', { page: pageNumber }, function (data) {
                $('#feedTableContainer').html(data);
            });
        }

        // Initial load
        $(document).ready(function () {
            loadPage(1);
            $("#hdnPageNo").val("1");
            // Delegate click event to future pagination links
            $(document).on("click", ".pagination a", function (e) {
                e.preventDefault();
                var page = $(this).attr("data-page");
                 $("#hdnPageNo").val(page);
                loadPage(page);
            });

            $('#AddNew').click(function () {
              $.get('/User/PostFeedback' , function (data) {
                  $('#myModalContent').html(data);
                  $('#myModal').modal('show');
              });
          });

          $(document).on('click', '#btnSave', function (e) {
                         e.preventDefault();
                         var form = $('#addForm')[0];
                         var formData = new FormData(form);

                        if (!$(form).valid()) return;

                        $.ajax({
                            url: '/User/PostFeedback',
                            type: 'POST',
                            data: formData,
                            processData: false,
                            contentType: false,
                            success: function (res) {
                                if (res.success) {
                                    alert(res.message);
                                    $('#myModal').modal('hide');                                   
                                    loadPage($("#hdnPageNo").val())
                                }
                                else
                                {
                                    $('#msgArea').text(res.message);
                                }
                            },
                            error: function () {
                                $('#msgArea').text("Something went wrong.");
                            }
                        });
            });


            $(document).on('click', '.edit-btn', function (e) {
                        e.preventDefault();
                        var id = $(this).data('id');
                        $.get('/User/EditFeedback/' + id, function (data) {
                            $('#myModalContent').html(data);
                            $('#myModal').modal('show');
                        });
                  });

          $(document).on('click', '#btnUpdate', function (e) {
                         e.preventDefault();
                         var form = $('#editForm')[0];
                         var formData = new FormData(form);

                        if (!$(form).valid()) return;

                        $.ajax({
                            url: '/User/EditFeedback',
                            type: 'POST',
                            data: formData,
                            processData: false,
                            contentType: false,
                            success: function (res) {
                                if (res.success) {
                                    alert(res.message);
                                    $('#myModal').modal('hide');
                                    $('#msgArea').text('');
                                   loadPage($("#hdnPageNo").val())
                                }
                                else
                                {
                                    $('#msgArea').text(res.message);
                                    alert(res.message);
                                }
                            },
                            error: function () {
                                $('#msgArea').text("Something went wrong.");
                            }
                        });
            });

          $(document).on('click', '.delete-btn', function (e) {
                e.preventDefault();
                var id = $(this).data('id');
                if (confirm('Are you sure you want to delete this record?')) {
                    $.ajax({
                        url: '/User/Delete/' + id,
                        type: 'Delete',
                        success: function (result) {
                            // Optionally remove the row from the table
                            if(result.success){
                                alert(result.message);
                                 loadPage($("#hdnPageNo").val());
                            }
                        },
                        error: function () {
                            alert('Error deleting record.');
                        }
                    });
                }
            });



        });
    </script>
}